<!-- TRACK MATCH - FUTBOLA (FIXED SCORER LOGIC) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Track Match - futbola</title>
  <style>
    /* same styles as before, omitted for brevity */
    .scorer-columns button {
      width: 100%;
      margin-bottom: 6px;
      padding: 8px;
      background-color: #ff5a5f;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="overlay" id="overlay" onclick="closePopup()"></div>
<div class="scorer-popup" id="scorerPopup">
  <div class="close-popup" onclick="closePopup()">Ã—</div>
  <h4>Select Scorer</h4>
  <div class="scorer-columns">
    <div><strong id="teamACol"></strong><div id="playersA"></div></div>
    <div><strong id="teamBCol"></strong><div id="playersB"></div></div>
  </div>
</div>

<div class="container">
  <!-- same structure as before: timer, team displays, results -->
</div>

<script>
const duration = parseInt(sessionStorage.getItem("duration")) || 7;
const teamNames = JSON.parse(sessionStorage.getItem("teamNames") || "[]");
const teamPlayers = JSON.parse(sessionStorage.getItem("teamPlayers") || "[]");

let matchNumber = 0;
let matchups = generateRoundRobin(teamNames);
let timeElapsed = 0, timer = null, timerRunning = false, timerPaused = false;
let currentGoals = [];
let matchResults = [];
let standings = {};
let allGoals = [];

function triggerScorer(side) {
  const teamA = document.getElementById("teamAName").textContent;
  const teamB = document.getElementById("teamBName").textContent;
  const idxA = teamNames.indexOf(teamA);
  const idxB = teamNames.indexOf(teamB);

  const divA = document.getElementById("playersA");
  const divB = document.getElementById("playersB");
  divA.innerHTML = "";
  divB.innerHTML = "";
  document.getElementById("teamACol").textContent = teamA;
  document.getElementById("teamBCol").textContent = teamB;

  if (side === "A") {
    teamPlayers[idxA].forEach(p => {
      divA.innerHTML += `<button onclick="addGoal('${teamA}', '${p}', false)">${p}</button>`;
    });
    teamPlayers[idxB].forEach(p => {
      divB.innerHTML += `<button onclick="addGoal('${teamA}', '${p}', true)">${p} (OG)</button>`;
    });
  } else {
    teamPlayers[idxB].forEach(p => {
      divB.innerHTML += `<button onclick="addGoal('${teamB}', '${p}', false)">${p}</button>`;
    });
    teamPlayers[idxA].forEach(p => {
      divA.innerHTML += `<button onclick="addGoal('${teamB}', '${p}', true)">${p} (OG)</button>`;
    });
  }

  document.getElementById("scorerPopup").style.display = "block";
  document.getElementById("overlay").style.display = "block";
}

function closePopup() {
  document.getElementById("scorerPopup").style.display = "none";
  document.getElementById("overlay").style.display = "none";
}

function addGoal(team, player, isOG = false) {
  const min = Math.floor(timeElapsed / 60);
  const extra = min >= duration ? `+${min - duration}` : "";
  const timeStr = `${Math.min(min + 1, duration)}${extra}'`;

  const scoreId = (team === document.getElementById("teamAName").textContent) ? "scoreA" : "scoreB";
  const logId = (scoreId === "scoreA") ? "goalLogA" : "goalLogB";

  document.getElementById(scoreId).textContent = parseInt(document.getElementById(scoreId).textContent) + 1;
  currentGoals.push({ team, player, time: timeStr, isOG });

  // Render goals
  const grouped = {};
  currentGoals.filter(g => g.team === team).forEach(g => {
    const label = g.isOG ? `${g.player} OG` : g.player;
    if (!grouped[label]) grouped[label] = [];
    grouped[label].push(g.time);
  });

  document.getElementById(logId).innerHTML = Object.entries(grouped)
    .map(([p, times]) => `<div class="goal-line">${p} ${times.join(", ")}</div>`).join("");

  closePopup();
}

// The rest of the script (timer, standings, summary export, etc.) is unchanged
</script>

</body>
</html>
